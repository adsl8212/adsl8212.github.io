{"pages":[],"posts":[{"title":"SQL面試作業紀錄","text":"此為去某家公司所出的面試作業，一開始寫的時候SQL全忘光了，面試時當然被洗臉，特此紀錄一下作業跟當時沒搞懂的部分 第一大題給定了兩個tableDEPARTMENTS department_id name 1 IT 2 HR 3 Sales 4 Marketing EMPLOYEES employee_id department_id manager_id name salary 1 1 Dale 100,000 2 1 1 Ben 100,000 3 1 1 Aaron 90,000 4 2 5 Phoenix 250,000 5 2 Lyot 200,000 6 1 5 Joseph 90,000 query employees (name) who have a bigger salary than their manager找到比老闆薪水高的職員名字 12345SELECT e.name AS 'Employee Name', e2.name AS 'Manager Name', e.salary AS 'Employee salary', e2.salary AS 'Manager salary'FROM EMPLOYEES eJOIN EMPLOYEES e2 ON e.manager_id = e2.employee_idWHERE e2.salary &lt; e.salary; query employees(name) who have the biggest salary in their departments找到在每個部門內薪水最高的職員名字 12345678910111213SELECT e.name AS 'Employee Name'FROM departments d JOIN employees e ON e.department_id = d.department_idWHERE e.salary IN ( SELECT MAX(emax.salary) FROM employees emax WHERE emax.department_id = d.department_id);#使用subquery效能較差的問題，可以不用subquery#↓修正的答案SELECT e.name AS 'Employee Name'FROM employees eJOIN (SELECT Max(salary) as 'max_salary' FROM employees GROUP BY department_id) as e2ON e.salary = e2.max_salary; query employees(name) who don’t have a manager in the same department找到在同個部門內沒有管理者的職員名字 123456SELECT e.name AS 'Employee Name', e2.name AS 'Boss', d.name AS \"Employee's Department\", d2.name AS \"Boss' Department\"FROM employees eJOIN employees e2 ON e.manager_id = e2.employee_idJOIN departments d ON e.department_id = d.department_idJOIN departments d2 ON e2.department_id = d2.department_idWHERE e.manager_id != 0 AND d.department_id != d2.department_id query the third highest salary of employees找到薪水第三高的職員 12345678910SELECT MIN(e.salary)FROM EMPLOYEES eJOIN (SELECT employee_id,salary FROM EMPLOYEES ORDER BY salary DESC LIMIT 3) AS e2 ON e.employee_id=e2.employee_id;#這裡只找出第三高的薪水而已#↓修正的答案SELECT *FROM employeesJOIN(SELECT MIN(e.salary) as 'min_salary' FROM(SELECT salary from employees ORDER BY salary DESC LIMIT 3) as e) as e2ON salary=e2.min_salary; 第二大題datas ID userID Date count 1 001 2017-01-01 11 2 001 2017-01-02 108 3 001 2017-01-03 151 4 001 2017-01-04 97 5 001 2017-01-05 144 6 001 2017-01-06 1450 7 001 2017-01-07 198 8 001 2017-01-08 187 9 001 2017-01-09 134 Write a query to display the records which have 3 or more consecutive days and the count more than 100(inclusive)query哪些天 連續三天的計數次數超過100 1234567891011select d1.*from DATAS d1, DATAS d2, DATAS d3where d1.count &gt;= 100and ((d1.id = d2.id + 1 and d1.id = d3.id - 1) #324 or (d1.id = d2.id + 1 and d1.id = d3.id + 2) #234 or (d1.id = d2.id - 1 and d1.id = d3.id - 2)) #432and d2.count &gt;= 100and d3.count &gt;= 100GROUP BY d1.id#有表格資料太大的缺點 N^3 承上題，想針對”每個使用者的連續計數次數超過100的天數”做資料分析。首先，必須把使用者的連續超過次數天數儲存下來：以上面的資料為例：userID: 001, Date: 2017-01-02 ~ 201701-03, continuous day: 2userID: 001, Date: 2017-01-05 ~ 201701-09, continuous day: 5請設計一套流程以及資料庫結構，每天結束後即產生”使用者的連續天數”並儲存下來。 這題想要知道的是如果我”每天”都要把連續天數儲存下來，應該怎麼存先從表格欄位討論，應該有的如下1. ID2. userID3. start_date4. end_date5. continuous day我們假設今天就是第一筆資料 ID userID start_date end_date continuous_day 1 001 2019-04-16 2019-04-16 1 假設今天有超過100我們將今天存下來，continuous_day +1到了隔天，我們查看同個使用者的cout，假設4/17 count為135那麼我們去檢查4/17的前一天有沒有end_date 的資料，若有，我們將那筆資料的end_date更新為4/17，並將continuous_day 值+1 ，我們就可以得到以下表格 ID userID start_date end_date continuous_day 1 001 2019-04-16 2019-04-17 2 接下來4/18以此類推，到了4/19，假設這天001的count並沒有超過100，我們就直接略過。到了4/20，又超過100了，但是4/20的前一天4/19並沒有在end_date 裡面，因此我們就直接新增一筆資料 ID userID start_date end_date continuous_day 1 001 2019-04-16 2019-04-18 3 2 001 2019-04-20 2019-04-20 1 這樣就完成了整個資料流程了","link":"/2019/04/16/SQL面試作業紀錄/"},{"title":"Raspberry Pi建置","text":"Raspberry Pi 又稱作「樹梅派」，是一款基於 Linux 系統、只有一張信用卡大小的單板機電腦，是由英國的樹莓派基金會所開發，目的是以低價硬體及自由軟體刺激在學校的基本的電腦科學教育。Raspberry Pi 可以和螢幕、鍵盤滑鼠連結後成為一台小型電腦，和一般電腦一樣可以執行如文字圖形處理、遊戲和程式編譯等功能。 硬體 Raspberry Pi3 SoC Broadcom BCM2837（CPU，GPU DSP和SDRAM、USB） CPU ARM Cortex-A53 64位元 (ARMv8系列) 1.2GHz (四核心) GPU Broadcom VideoCore IV[43], OpenGL ES 2.0, 1080p 30 h.264/MPEG-4 AVC高畫質解碼器 記憶體 1024 MB (LPDDR2) 影像輸出 畫面用RCA端子（PAL &amp; NTSC）、HDMI，HDMI介面可使用14種解析度，分別從640×350到1920×1200之間 板載儲存 MicroSD卡插槽 網路介面 10/100Mbps 乙太網介面（RJ45介面），支援802.11n無線網路及藍牙4.1 軟體Raspberry Pi作為一款ARM微型電腦板(Single-board computer)，就離不開安裝作業系統(OS)，樹莓派基金會(Raspberry Pi Foundation)提供了數款Linux系統給大家安裝，以下介紹幾款常用的作業系統。 Raspbian (官方建議)這是衍生自 Debian 的發行版，也是目前 Raspberry Pi 的主要發行版，初學者或是 Linux 新手強烈推薦使用這一套，支援多、資料多。 Ubuntu Mate在 Debain 家族裡，Ubuntu 算是能見度最高的一個，而這套是 Ubuntu 官方維護的發行版。 RISC OS從名稱就知道，這是一套專為 RISC 架構所開發的發行版，開發團隊就是 ARM 原廠，所以在 ARM Base CPU 上當然有最好的效果。 Snappy Ubuntu CoreUbuntu 官方的說法是，這是一套極小的伺服器等級發行版，使用跟 PC 相同的函數庫，但是應用程式部份是使用另一種更簡單的運作機制來維護，讓系統兼顧可靠、安全、易用等特性。 Raspbian LITE和Raspbian主要分別在於 Jessie Lite 沒有預設安裝 X-server 與相關的套件，因此無法用 startx 啟動視窗管理員。因為也沒有安裝 Qt 和 GTK+ 的函式庫，因此也無法執行相關的視窗程式。主要作為伺服器用途 安裝作業系統到樹梅派需要工具:MicroSD讀卡機 首先要將作業系統放到SD卡裡，先用讀卡機將SD卡連結到電腦中 要先將MicroSD卡先格式化，這邊推薦使用SD卡官方的格式化工具SD Formatter電腦讀取到SD卡後，開啟SD Formatter 確認Drive是你的SD卡磁碟代號 格式化完了之後到Raspberry Pi官網下載作業系統，下載Raspbian 下載下來解壓縮之後會得到一個 .img 的映像檔然後下載Win32DiskImager，這是一個映像檔燒錄工具，能夠把作業系統的映像檔燒錄到你的SD卡裡。安裝完成後選擇剛剛下載的Raspbian的img檔，然後指定你的SD卡的硬碟代號注意要燒錄的磁碟代號是否為你的SD卡，點擊Write，將系統抄到SD卡上。燒錄成功win10若是燒錄失敗，對著Win32DiskImager程式右鍵&gt;內容&gt;相容性勾選以相容模式執行這個程式選擇win7 燒錄成功後就可以將SD卡取出插到Raspberry Pi上，接上螢幕(HDMI)和鍵盤滑鼠 若是使用HDMI轉VGA在取出SD卡前必須先修改燒錄後資料夾中Config.txt這個檔案修改其中內容 #uncomment if hdmi display is not detected and composite is being outputhdmi_force_hotplug=1 #uncomment to force a specific HDMI mode (this will force VGA)hdmi_group=2hdmi_mode=16 #uncomment to force a HDMI mode rather than DVI. This can make audio work in #DMT (computer monitor) modeshdmi_drive=2將以上四行刪去註解 hdmi_force_hotplug=1: 設定為強制從HDMI輸出。輸出Raspberry Pi的視訊輸出有RCA端子與HDMI。系統預設從RCA端子輸出，如果偵測到有接HDMI，就會從HDMI輸出。但因為使用轉接頭或轉接線，Raspberry Pi可能無法正常偵測到HDMI，於是以RCA端子輸出視訊，導致沒畫面。 hdmi_group：用來指定要使用 CEA 或 DMT 的格式設定解析度。 hdmi_mode： hdmi_mode=16 時，表示使用 1024x768 60 Hz 的解析度。 hdmi_drive：設定要驅動 DVI (1) 還是 HDMI (2)，必須使用 HDMI ，也就是設定為 2 才會有聲音。而hdmi_mode這個參數與解析度對照如下表(點圖放大) Raspberry Pi沒有電源開關，只要接上電源，就會直接啟動 系統內設定進入系統畫面之後，接下來要進行內部設定打開terminal 輸入 raspi-config開始進行設定，使用空白鍵選擇以及取消重要的設定有1 Expand Filesystemㄣ 系統預設會先分割出一個 FAT32 格式 64MB 大小的分割區用來開機，而剩餘的空間必須執行這個選項來建立分割區才可使用。 2 Change User Password 變更預設使用者「pi」的密碼，未修改之前的預設密碼是「raspberry」。 5 Internationalisation Options 裡面有 3 個子選項，用來修改語系、時區及鍵盤排列。 修改語系: 建議取消預設的「en_GB.UTF8」，選擇「en_US.UTF8」，想要讓系統訊息用中文顯示，選擇「zh_TW.UTF8」 修改時區: 因為Raspberry Pi沒有內建實時時鍾，它並不會自動儲存時間，需要依靠連接到網絡的時間伺服器下載資料，所以我們需要為Raspberry Pi指定地點，從而得到準確的時間，如下圖選擇 4 Internationalisation Options &gt; I2 Change Timezone，進入地區設定頁 ，選擇自己位處的地點。 修改鍵盤排列: 因為Raspberry Pi預設為英式鍵盤排列，必須修改為美式鍵盤以符合我們的按鍵 設定完成後重新開機 如果設定為中文介面後無法正常顯示，顯示為亂碼，可能是沒有中文字型庫輸入以下指令安裝文泉驛正黑體1$ sudo apt-get install ttf-wqy-zenhei 安裝完成後重新開機","link":"/2016/08/20/Raspberry-Pi建置/"},{"title":"使用GCP BigQuery進行基本操作","text":"因為偶然看到一個免費的課程，又可以免費試用看看GCP，因此紀錄下學習過程。本篇紀錄在 Google 的 Qwiklabs 平台，完成「BigQuery For Data Analysis」這個 quest 的學習內容，其中包括了基本SQL在BigQuery 和 Cloud SQL中的使用、如何將數據載入Cloud SQL中，如何使用BigQuery、Cloud SQL進行query等。 BigQuery BigQuery是一個PB級資料庫託管服務，可以在Google Cloud Platform上運行。 數據分析師和數據科學家可以快速查詢和過濾大型資料集，匯總結果並執行複雜的操作，不必擔心設置和管理伺服器。 它以命令工具（已預先安裝在cloud shell中）或以Web控制台的形式進行操作。 Cloud SQL Cloud SQL也是一個資料庫託管服務，可以輕鬆地在雲端上設置、維護、管理PostgreSQL和MySQL資料庫。 Cloud SQL接受兩種格式的資料 轉儲文件（.sql） CSV文件（.csv） 開始lab，登入GCP Console 因為參加了ML Study Jam的活動，提供了Qwiklabs一個月的免費額度 點擊右上方的Start Lab開始記得要選擇一段不被打擾的時間進行，因為Qwiklabs是產生一組暫時的google帳號密碼讓你登入google cloud，因此開始的計時就是此暫時帳號可以使用的時間。 接著會出現此畫面，因為是使用Qwiklabs提供的一個月免費額度，因此這裡點選Use Subscription 畫面左邊就會產生一組暫時的GCP帳號，複製帳號密碼，使用無痕打開GCP Console 這裡因為通常大家都會登入自己的google帳號，如果使用原本瀏覽器的話，可能會跳到自己的帳號產生衝突，因此建議使用無痕模式進行實作哦~ 成功登入後就可以開始使用GCP囉~ 開啟Google Cloud Shell 在GCP主頁面的右上方工具列點擊Activate Cloud Shell 注意左邊project有沒有選到qwiklabs的暫時帳號的project 打開後於彈出視窗點擊START CLOUD SHELL 連結成功後代表驗證成功羅~ 使用BigQuery進行查詢 載入公開資料集 首先我們點開左邊工具欄進入BigQuery頁面 接著我們要載入資料集來進行練習，點擊左邊的ADD DATA &gt; Explore public datasets 在搜尋欗輸入london bicycle hires，點擊搜尋結果並View Dataset 會開啟一個新的視窗，在左方會看到一個新的project bigquery-public-data點擊此專案bigquery-public-data &gt; london_bicycles &gt; cycle_hire這是一個倫敦的腳踏車租借資料集 這樣就載入完成了 使用SQL進行query這是一個2015年至2017年期間在倫敦的腳踏車租借資料，大約有24,369,201筆（無論如何都不是少量！）這邊就是先使用SQL基礎的SELECT、FROM、WHERE等指令進行查詢 在Query editor中輸入以下指令並點擊 RUN1SELECT end_station_name FROM `bigquery-public-data.london_bicycles.cycle_hire`; 我們可以看到query結果顯示在下方 接著我們再嘗試其他指令，我們試著找出租借時間大於20分鐘的資料，一樣在Query editor中輸入以下指令1SELECT * FROM `bigquery-public-data.london_bicycles.cycle_hire` WHERE duration&gt;=1200; 看到右下角，則會看到返回了7,334,890筆資料。 作為總數的一小部分（7334890/24369201），這意味著大約30％的倫敦腳踏車租借都持續了20分鐘或更長時間。也可以看到執行時間大概30秒，執行速度真的很快R。 還有其他的指令如ORDER BY、COUNT等等都是相同的做法。 使用Cloud SQL進行查詢 建立雲端儲存庫 我們要將cycle_hire子集導出為CSV文件，並將其上傳到雲端儲存庫。我們使用BigQuery來產生子集 1SELECT start_station_name, COUNT(*) AS num FROM `bigquery-public-data.london_bicycles.cycle_hire` GROUP BY start_station_name ORDER BY num DESC; 1SELECT end_station_name, COUNT(*) AS num FROM `bigquery-public-data.london_bicycles.cycle_hire` GROUP BY end_station_name ORDER BY num DESC; 在query結果上方選擇SAVE RESULTS &gt; CSV，將query結果下載下來 接著我們要將這個子集上傳到雲端儲存庫點擊左邊工具列 Storage &gt; Browser，點擊Create bucket，在欄位中輸入名字其他的欄位不動然後Create 然後就可以在GCP控制台中看到剛剛創建的雲端儲存庫，接著我們要將剛剛兩個生成的子集CSV檔上傳上去，點擊Upload files然後選擇剛剛下載的csv檔案，上傳完成後我們將它重新命名為start_station_data.csv以及end_station_data.csv 建立Cloud SQL接著建立好雲端儲存庫且放上資料表後我們要利用它來建立SQL實體，選擇左邊工具列SQL，點擊Create Instance，接著選擇MySQL之後輸入資料庫實體的名稱(像這裡是qwiklabs-demo)、密碼，點選Create接著就是等待實體建置完成，需要等待蠻長的時間，建立好了之後可以看到名稱左邊有個綠色勾勾囉，點擊實體名稱就可以進入控制台 在Cloud SQL中進行query 現在我們已經建立好Cloud SQL實體了，接著我們就可以使用Cloud Shell Command Line來建立一個資料庫在Cloud Shell中執行以下命令，用來連結到我們的SQL實體，qwiklabs-demo為實體名稱1gcloud sql connect qwiklabs-demo --user=root 出現以下結果代表連結成功接著我們要在我們的資料庫中放入剛剛上傳的兩個資料集，因此我們創建一個名叫bike的資料庫1CREATE DATABASE bike; 接著我們要在資料庫(database)中建立兩個資料表(table)，執行以下指令 12USE bike;CREATE TABLE london1 (start_station_name VARCHAR(255), num INT); 12USE bike;CREATE TABLE london2 (end_station_name VARCHAR(255), num INT); 創建好資料表後我們要將剛剛上傳的兩個csv檔連結到創建好的資料表 打開 Cloud SQL “qwiklabs-demo” 的實體頁面, 點擊IMPORT 進入頁面後點擊Browse，選擇儲存庫名稱接著選擇我們生成的csv文件 在Table欗位分別填入 london1 london2，點擊Import 現在應該將兩個CSV文件上傳到了資料表中了，我們回到Cloud Shell中並輸入指令 1SELECT * FROM london1; 就可以得到query結果也就可以執行其他SQL query啦~~ 以上就是Quest中最基礎的課程，第一次使用GCP時有點手忙腳亂XD，使用Qwiklabs也是一個視窗看教學一個視窗實作還要注意時間，有點忙碌，但整體來說見識到BigQuery的速度。之後應該還會寫一個BigQuery ML的課程紀錄ㄅ","link":"/2019/05/08/使用GCP BigQuery進行資料分析/"}],"tags":[{"name":"SQL","slug":"SQL","link":"/tags/SQL/"},{"name":"面試","slug":"面試","link":"/tags/面試/"},{"name":"樹梅派","slug":"樹梅派","link":"/tags/樹梅派/"},{"name":"Raspberry Pi","slug":"Raspberry-Pi","link":"/tags/Raspberry-Pi/"},{"name":"GCP","slug":"GCP","link":"/tags/GCP/"},{"name":"Qwiklab","slug":"Qwiklab","link":"/tags/Qwiklab/"}],"categories":[{"name":"求職","slug":"求職","link":"/categories/求職/"},{"name":"學校","slug":"學校","link":"/categories/學校/"},{"name":"GCP","slug":"GCP","link":"/categories/GCP/"}]}